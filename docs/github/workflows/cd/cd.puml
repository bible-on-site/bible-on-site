@startuml CD Workflow
!theme plain
skinparam backgroundColor #FEFEFE
skinparam ActivityBackgroundColor #E8F4FD
skinparam ActivityBorderColor #2196F3
skinparam ActivityFontColor #1565C0
skinparam ArrowColor #1976D2
skinparam ActivityBarColor #1976D2

title Continuous Deployment Workflows

|#E8F4FD|cd-aws.yml|
start
:repository_dispatch\n(deploy-aws);
note right
  From shared-release.yml:
  module_name, module_version,
  released_artifact_name, ci_run_id
end note

:Setup & AWS Auth (OIDC);
:Restore Docker Image from CI;
:**Push to ECR**;
note right
  Tags: version + latest
end note
:ECS Auto-Deploy;
note right
  EventBridge triggers
  on 'latest' tag
end note
stop

|#E8F5E9|cd-app.yml|
start
:repository_dispatch\n(deploy-app);
note right
  From release_app job in ci.yml:
  module_version, ci_run_id,
  windows/android artifact names
end note

fork
  :Restore MSIX;
  :**Deploy to MS Store**;
  note right
    Flight: Internal
    Partner Center API
  end note
fork again
  :Restore AAB;
  :**Deploy to Google Play**;
  note right
    Track: Internal
    Play Console API
  end note
end fork
stop

|#FFF3E0|cd-data.yml|
start
:repository_dispatch\n(deploy-data);
note right
  From release_data job in ci.yml
end note

:Setup & AWS Auth (OIDC);
:**Run Data Migration**;
stop

@enduml
