---
description: Flip book (html-flip-book) integration and local dev workflow
globs: web/bible-on-site/**/929/**/*,**/Sefer*.tsx,**/FlipBook*,**/copy-local-flip-book*
alwaysApply: false
---

# Flip Book Integration

## Local dev with local html-flip-book repo

- **Build** in `html-flip-book`: `npm run build`
- **Copy into website** from `web/bible-on-site`: `USE_LOCAL_FLIP_BOOK=1 npm run postinstall` (or add a script that runs that) to copy the local build into node_modules.

The website depends on the **published** `html-flip-book-react` package for CI/production; the copy script only runs when `USE_LOCAL_FLIP_BOOK=1` or when the dependency is `file:`.

## Publishing html-flip-book — fully automated, never manual

**Never run `npm publish` manually. Never create GitHub Releases manually.**

The `html-flip-book` repo has a fully automated CI/CD pipeline:
1. **CI** (`ci.yml`): On every push to master, after lint/build/tests pass, the **Release** job auto-creates a GitHub Release (tag from `base/package.json` version). It uses `BOT_PAT` so the release event triggers downstream workflows.
2. **CD** (`cd.yml`): Triggered by the release event. Publishes both `html-flip-book-vanilla` and `html-flip-book-react` to npm via OIDC trusted publishing.
3. **Auto Bump** (`auto-bump-version.yml`): After release, bumps the version in all `package.json` files and commits to master.

**To get a new version published:** just merge to master. Everything else is automatic.

## Keeping bible-on-site CI green after library changes

When `html-flip-book` types or APIs change, the **published npm package must be updated before** `bible-on-site` CI can pass. Sequence:
1. Push & merge library changes → create a release → CD publishes to npm.
2. Only then update `bible-on-site` to use the new version and push.
