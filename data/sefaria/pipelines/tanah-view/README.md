# tanah-view

A Rust CLI tool that generates a Tanah view from a MongoDB Sefaria dump. The output can be either JSON or SQLite.

## Usage

```bash
cargo run -p tanah-view -- --help
```

## Aggregation Pipeline

The aggregation pipeline in [aggregation.rs](src/aggregation.rs) contains the MongoDB aggregation stages that transform Sefaria data into the Tanah view format.

### Cycle Dates

The `date` field in the `$addFields` stage uses `$arrayElemAt` with a pre-computed array of 929 Hebrew dates representing the 4 cycles of the 929 project (starting Tishrei 5775, 5783, 5790, and 5797).

This date array is generated by the `cycles` crate. To regenerate it:

```bash
cargo make generate-cycle-dates
```

Then copy the JSON array from `cycles/.output/cycles.json` into the `$arrayElemAt` array in `aggregation.rs`.
