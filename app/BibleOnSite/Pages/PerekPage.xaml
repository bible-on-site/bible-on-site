<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:BibleOnSite.ViewModels"
             xmlns:models="clr-namespace:BibleOnSite.Models"
             x:Class="BibleOnSite.Pages.PerekPage"
             x:DataType="viewmodels:PerekViewModel"
             Title="{Binding Source}"
             FlowDirection="RightToLeft">

    <ContentPage.ToolbarItems>
        <ToolbarItem
            x:Name="ArticlesButton"
            AutomationId="ArticlesButton"
            Text="ðŸ“š"
            Command="{Binding GoToArticlesCommand}"
            SemanticProperties.Description="View articles"/>
        <ToolbarItem
            x:Name="BookmarkButton"
            AutomationId="BookmarkButton"
            Text="â­"
            Command="{Binding ToggleBookmarkCommand}"
            SemanticProperties.Description="Toggle bookmark"/>
        <ToolbarItem
            x:Name="PreviousButton"
            AutomationId="PreviousButton"
            Text="â—€"
            Command="{Binding LoadPreviousCommand}"
            SemanticProperties.Description="Previous perek"/>
        <ToolbarItem
            x:Name="NextButton"
            AutomationId="NextButton"
            Text="â–¶"
            Command="{Binding LoadNextCommand}"
            SemanticProperties.Description="Next perek"/>
    </ContentPage.ToolbarItems>

    <Grid RowDefinitions="Auto,*,Auto">
        <!-- Header Section -->
        <VerticalStackLayout Grid.Row="0"
                             Padding="16,12"
                             BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}">
            <Label
                Text="{Binding Source}"
                FontSize="24"
                FontAttributes="Bold"
                HorizontalTextAlignment="Center"
                TextColor="White"/>
            <Label
                Text="{Binding HebDate}"
                FontSize="14"
                HorizontalTextAlignment="Center"
                TextColor="White"
                Opacity="0.9"/>
            <Label
                Text="{Binding Header}"
                FontSize="16"
                HorizontalTextAlignment="Center"
                TextColor="White"
                IsVisible="{Binding Header, Converter={StaticResource StringNotEmptyConverter}}"
                Margin="0,8,0,0"/>
        </VerticalStackLayout>

        <!-- Perek Text - Pasukim List -->
        <CollectionView Grid.Row="1"
                        ItemsSource="{Binding Perek.Pasukim}"
                        SelectionMode="None"
                        Margin="8,0">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:Pasuk">
                    <Frame Padding="12,8"
                           Margin="0,4"
                           CornerRadius="8"
                           BackgroundColor="{AppThemeBinding Light={StaticResource Surface}, Dark={StaticResource SurfaceDark}}"
                           BorderColor="Transparent">
                        <Grid ColumnDefinitions="40,*">
                            <Label Grid.Column="0"
                                   Text="{Binding PasukNumHeb}"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   VerticalTextAlignment="Start"
                                   TextColor="{StaticResource Primary}"/>
                            <Label Grid.Column="1"
                                   AutomationId="PasukText"
                                   Text="{Binding Text}"
                                   FontSize="18"
                                   LineBreakMode="WordWrap"
                                   LineHeight="1.4"/>
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

            <CollectionView.EmptyView>
                <VerticalStackLayout VerticalOptions="Center"
                                     HorizontalOptions="Center"
                                     Padding="20">
                    <Label Text="×˜×•×¢×Ÿ..."
                           AutomationId="PerekLoadingLabel"
                           FontSize="18"
                           HorizontalTextAlignment="Center"/>
                    <ActivityIndicator IsRunning="True"
                                       Margin="0,10,0,0"/>
                </VerticalStackLayout>
            </CollectionView.EmptyView>
        </CollectionView>

        <!-- Bottom Navigation Bar -->
        <Grid Grid.Row="2"
              ColumnDefinitions="*,*,*"
              Padding="8"
              BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray900}}">
            <Button Grid.Column="0"
                    Text="×”×§×•×“×"
                    Command="{Binding LoadPreviousCommand}"
                    BackgroundColor="Transparent"
                    TextColor="{StaticResource Primary}"/>
            <Label Grid.Column="1"
                   Text="{Binding PerekId, StringFormat='{0}/929'}"
                   FontSize="14"
                   VerticalTextAlignment="Center"
                   HorizontalTextAlignment="Center"/>
            <Button Grid.Column="2"
                    Text="×”×‘×"
                    Command="{Binding LoadNextCommand}"
                    BackgroundColor="Transparent"
                    TextColor="{StaticResource Primary}"/>
        </Grid>
    </Grid>

</ContentPage>
