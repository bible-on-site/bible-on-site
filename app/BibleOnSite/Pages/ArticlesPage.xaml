<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:BibleOnSite.ViewModels"
             xmlns:models="clr-namespace:BibleOnSite.Models"
             xmlns:controls="clr-namespace:BibleOnSite.Controls"
             x:Class="BibleOnSite.Pages.ArticlesPage"
             x:DataType="viewmodels:ArticlesViewModel"
             Title="{Binding DisplayTitle}"
             FlowDirection="RightToLeft"
             Shell.NavBarIsVisible="False">

       <Grid RowDefinitions="Auto,*">
              <!-- Toolbar with back button and title -->
              <Grid Grid.Row="0"
                    Padding="8,8,8,4"
                    ColumnDefinitions="Auto,*,Auto"
                    BackgroundColor="{AppThemeBinding Light={StaticResource Surface}, Dark={StaticResource SurfaceDark}}">
                     <Button Grid.Column="0"
                             Text="â†’"
                             FontSize="24"
                             BackgroundColor="Transparent"
                             TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource Gray100}}"
                             Clicked="OnBackClicked"
                             SemanticProperties.Description="×—×–×•×¨"/>
                     <Label Grid.Column="1"
                            Text="{Binding DisplayTitle}"
                            FontSize="18"
                            FontAttributes="Bold"
                            VerticalTextAlignment="Center"
                            TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource Gray100}}"/>
                     <Label Grid.Column="2"
                            Text="{Binding Articles.Count, StringFormat='{0} ×ž××ž×¨×™×'}"
                            FontSize="12"
                            VerticalTextAlignment="Center"
                            TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}"
                            IsVisible="{Binding HasArticles}"/>
              </Grid>

              <!-- Articles Grid with CollectionView for lazy loading/virtualization -->
              <CollectionView Grid.Row="1"
                              ItemsSource="{Binding Articles}"
                              Margin="8,8,8,0">
                     <CollectionView.ItemsLayout>
                            <GridItemsLayout Orientation="Vertical"
                                             Span="2"
                                             HorizontalItemSpacing="8"
                                             VerticalItemSpacing="8"/>
                     </CollectionView.ItemsLayout>
                     <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:Article">
                                   <controls:ArticleCard Article="{Binding .}" ShowPerekSource="True">
                                          <controls:ArticleCard.GestureRecognizers>
                                                 <TapGestureRecognizer Tapped="OnArticleTapped"
                                                                       CommandParameter="{Binding .}"/>
                                          </controls:ArticleCard.GestureRecognizers>
                                   </controls:ArticleCard>
                            </DataTemplate>
                     </CollectionView.ItemTemplate>
              </CollectionView>

              <!-- Empty/Loading State Overlay -->
              <VerticalStackLayout Grid.Row="1"
                                   VerticalOptions="Center"
                                   HorizontalOptions="Center"
                                   Padding="20"
                                   IsVisible="{Binding HasArticles, Converter={StaticResource InvertedBoolConverter}}">
                     <!-- Loading State -->
                     <VerticalStackLayout IsVisible="{Binding IsLoading}">
                            <Image Source="loading_book_anim.gif"
                                   IsAnimationPlaying="{Binding IsLoading}"
                                   HeightRequest="60"
                                   WidthRequest="60"
                                   Aspect="AspectFit"
                                   Margin="0,10,0,0"/>
                            <Label Text="×ž×ª×—×‘×¨ ×œ×ž××ž×¨×™×..."
                                   FontSize="16"
                                   HorizontalTextAlignment="Center"
                                   Margin="0,10,0,0"/>
                     </VerticalStackLayout>

                     <!-- No Articles State -->
                     <VerticalStackLayout IsVisible="{Binding IsLoading, Converter={StaticResource InvertedBoolConverter}}">
                            <Label Text="ðŸ“š"
                                   FontSize="48"
                                   HorizontalTextAlignment="Center"/>
                            <Label Text="××™×Ÿ ×ž××ž×¨×™×"
                                   FontSize="18"
                                   HorizontalTextAlignment="Center"
                                   Margin="0,10,0,0"/>
                            <Label Text="{Binding ErrorMessage}"
                                   FontSize="14"
                                   TextColor="{StaticResource Error}"
                                   HorizontalTextAlignment="Center"
                                   IsVisible="{Binding ErrorMessage, Converter={StaticResource StringNotEmptyConverter}}"
                                   Margin="0,10,0,0"/>
                     </VerticalStackLayout>
              </VerticalStackLayout>
       </Grid>

</ContentPage>
